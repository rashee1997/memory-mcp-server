# Source Attribution

This document details how the Memory MCP Server tracks and logs the origin of information used or generated by AI agents. This is crucial for transparency, reproducibility, and understanding the provenance of agent knowledge.

## Purpose

The `source_attribution` table and associated tools (`log_source_attribution`, `get_source_attributions`) are designed to:

*   Record where an AI agent's knowledge or output originated (e.g., user input, web search, internal reasoning).
*   Provide a link back to the original source (e.g., URL, query string).
*   Enable auditing and debugging of agent behavior by tracing information flow.
*   Support compliance requirements for data provenance.

## Schema (`source_attribution` table)

| Column Name         | Type    | Description                                                              |
| :------------------ | :------ | :----------------------------------------------------------------------- |
| `attribution_id`    | `TEXT`  | Unique identifier for each attribution entry (UUID).                     |
| `agent_id`          | `TEXT`  | Identifier of the AI agent that used or generated the information.       |
| `source_type`       | `TEXT`  | Category of the source (e.g., `user_input`, `tavily_search`, `internal_reasoning`, `database_query`, `web_scrape`). |
| `source_uri`        | `TEXT`  | URI or identifier of the source (e.g., URL for web content, search query for Tavily, internal memory ID). Can be `NULL`. |
| `retrieval_timestamp` | `INTEGER` | Unix timestamp (milliseconds) when the information was retrieved or attributed. |
| `content_summary`   | `TEXT`  | A brief summary of the attributed content. Can be `NULL`.                |
| `full_content_hash` | `TEXT`  | Optional SHA256 hash of the full content for integrity checking. Can be `NULL`. |

## Usage

### `log_source_attribution` Tool

This tool is used by AI agents or system components to record source information.

**Input Schema:**

```json
{
  "type": "object",
  "properties": {
    "agent_id": { "type": "string", "description": "Identifier of the AI agent." },
    "source_type": { "type": "string", "description": "Type of source (e.g., user_input, tavily_search, internal_reasoning)." },
    "source_uri": { "type": "string", "description": "URI or identifier of the source (e.g., URL for web, query for Tavily).", "nullable": true },
    "retrieval_timestamp": { "type": "number", "description": "Unix timestamp of when the information was retrieved." },
    "content_summary": { "type": "string", "description": "Brief summary of the attributed content.", "nullable": true },
    "full_content_hash": { "type": "string", "description": "Optional, hash of the full content for integrity checking.", "nullable": true }
  },
  "required": ["agent_id", "source_type", "retrieval_timestamp"]
}
```

**Example Call:**

```xml
<use_mcp_tool>
<server_name>memory-mcp-server</server_name>
<tool_name>log_source_attribution</tool_name>
<arguments>
{
  "agent_id": "my-ai-agent-001",
  "source_type": "tavily_search",
  "source_uri": "latest advancements in large language models",
  "retrieval_timestamp": 1678886400000,
  "content_summary": "Summary of search results on LLM advancements from various research papers and articles."
}
</arguments>
</use_mcp_tool>
```

### `get_source_attributions` Tool

This tool is used to retrieve logged source attributions.

**Input Schema:**

```json
{
  "type": "object",
  "properties": {
    "agent_id": { "type": "string", "description": "Identifier of the AI agent." },
    "source_type": { "type": "string", "description": "Optional type of source to filter by.", "nullable": true },
    "limit": { "type": "number", "description": "Maximum number of attributions to retrieve.", "default": 100 },
    "offset": { "type": "number", "description": "Offset for pagination.", "default": 0 }
  },
  "required": ["agent_id"]
}
```

**Example Call:**

```xml
<use_mcp_tool>
<server_name>memory-mcp-server</server_name>
<tool_name>get_source_attributions</tool_name>
<arguments>
{
  "agent_id": "my-ai-agent-001",
  "source_type": "tavily_search",
  "limit": 10
}
</arguments>
</use_mcp_tool>
